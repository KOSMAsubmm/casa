
Bootstrap: docker
From: ubuntu:22.04

%post
    # Setting up the environment variable for non-interactive mode
    export DEBIAN_FRONTEND=noninteractive

    # Create user and group
    mkdir /home/casa
    groupadd -g 1000 casa
    useradd -g casa -u 1000 -d /home/casa casa
    chown casa:casa /home/casa

    # Install necessary tools and libraries
    apt update
    apt install -y wget xz-utils fuse xserver-xorg-dev sqlite libxext-dev libx11-6 libfontconfig1 libsm-dev xserver-xorg libgtk-3-dev
    rm -rf /var/lib/apt/lists/*

    # Download and extract casa-pipeline software (assuming it's available at the build location)
    cp /path/on/host/casa-6.4.1-12-pipeline-2022.2.0.64-py3.6.tar.xz .
    tar -xvf casa-6.4.1-12-pipeline-2022.2.0.64-py3.6.tar.xz
    rm casa-6.4.1-12-pipeline-2022.2.0.64-py3.6.tar.xz
    chown -R casa:casa casa-6.4.1-12-pipeline-2022.2.0.64

%runscript
    exec ../casa-6.4.1-12-pipeline-2022.2.0.64/bin/casa "$@"

%files
    /path/on/host/casa-6.4.1-12-pipeline-2022.2.0.64-py3.6.tar.xz /casa-6.4.1-12-pipeline-2022.2.0.64-py3.6.tar.xz
